<!DOCTYPE html>
<html>
	<head>
		<title>Dhyara Ad Hoc Network</title>
		<link rel="icon" href="data:,">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
		<meta content="utf-8" http-equiv="encoding">
		<link rel="stylesheet" href="/dhyara.css"/>
		<script>
		let d = document;
		let q = x => d.querySelectorAll(x);
		let create = (x, a, ...cs) => {
			let e = d.createElement(x);
			if(typeof a == 'object')
				for (let [k, v] of Object.entries(a)) 
					e.setAttribute(k, v);
            cs.forEach(c => e.append(c));
			return e;
		};
		d.addEventListener("DOMContentLoaded", function() {
			q("#menu li").forEach(li => li.append(
				create("img", {"class": "icon", "src": "/icons?"+li.dataset.icon}),
				create("a", {"class": "label", "href": li.dataset.href}, li.dataset.label)
			));
			q(".cell").forEach(cell => cell.prepend(create("span", {"class": "key"}, cell.dataset.key)));
			setTimeout(function(){
				fetch("/info.json").then(r => r.json()).then(function(info){
					let tr = (key, body) => q('#info-iface .cell[data-key="'+key+'"]')[0].append(body);
					tr('ssid', info.ap.ssid);
					tr('mac', info.ap.address);
					tr('channel', info.ap.channel + "(" + info.ap.bandwidth + "Mhz)");
					tr('frequency', info.ap.frequency.begin + "-" + info.ap.frequency.end + "Mhz)");
					tr('power saving', info.power.saving);
					tr('max power', info.power.max);
					tr('authentication', info.ap.authentication);
					tr('max clients', info.ap.max_connections);
				});
			}, 500);
			setInterval(() => {
				fetch("/routes.json").then(r => r.json()).then(function(routing){
					let rbody = q("#routes-body")[0], nbody = q("#next-body")[0];
					rbody.innerHTML = "";
					nbody.innerHTML = "";
					
					routing.routes.map(r => create('tr', {}, create('td', {}, r.dst), create('td', {}, r.via), create('td', {}, r.delay+"ms"), create('td', {}, r.updated))).forEach(e => rbody.append(e));
					routing.routes.map(r => create('tr', {}, create('td', {}, r.dst), create('td', {}, r.via), create('td', {}, r.delay+"ms"))).forEach(e => nbody.append(e));
				});
			}, 2000);
		});
		</script>
	</head>
	<body>
		<div class="wrapper">
			<div class="sidebar">
				<div class="logo">Dhyara</div>
				<ul id="menu" class="contents">
					<li data-label="Home" data-icon="home" data-href="/" />
					<li data-label="Routing" data-icon="routing" data-href="/routing" />
					<li data-label="Peers" data-icon="neighbourhood" data-href="#" />
				</ul>
			</div>
			<div class="main">
				<div class="central">
					<div class="full-w">
						<div class="board banner">
							<div id="info-iface" class="groups">
								<div class="group">
									<div class="cell" data-key="ssid"></div>
									<div class="cell" data-key="mac"></div>
								</div>
								<div class="group">
									<div class="cell" data-key="channel"></div>
									<div class="cell" data-key="frequency"></div>
								</div>
								<div class="group">
									<div class="cell" data-key="power saving"></div>
									<div class="cell" data-key="max power"></div>
								</div>
								<div class="group">
									<div class="cell" data-key="authentication"></div>
									<div class="cell" data-key="max clients"></div>
								</div>
							</div>
						</div>
					</div>
					<div class="full-flex-hz">
						<div class="board cluster-full">
							<div class="heading">Routing Table</div>
								<table>
									<thead>
										<tr>
											<th>Destination</th>
											<th>Intermediate</th>
											<th>Delay</th>
											<th>Updated</th>
										</tr>
									</thead>
									<tbody id="routes-body"></tbody>
								</table>
						</div>
					</div>
					<div class="full-flex-hz">
						<div class="board cluster-full">
							<div class="heading">Best Route</div>
							<table>
								<thead>
									<tr>
										<th>Destination</th>
										<th>Intermediate</th>
										<th>Delay</th>
									</tr>
								</thead>
								<tbody id="next-body"></tbody>
							</table>
						</div>
					</div>
				</div>
			</div>
		</div>
	</body>
</html>
