<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Dhyara: DHYARA</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="qtify.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Dhyara
   </div>
   <div id="projectbrief">Dhyara adhoc Network</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">DHYARA </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Dhyara is a ESP-IDF component for Layer 2 Mobile Ad-Hoc Networks on the top of ESP NOW. Dhyara is Open Source under BSD 2 Clause License. See <a class="el" href="_l_i_c_e_n_s_e_8md.html">LICENSE</a></p>
<p><a href="http://neel.github.io/dhyara">Doxygen Documentation</a></p>
<h1><a class="anchor" id="autotoc_md9"></a>
Compilation &amp; Integration</h1>
<p>Dhyara is a C++11 library that has to be used as an ESP-IDF component. It can be cloned to the <code>components</code> directory or can be used as a <code>git submodule</code> inside your projects <code>components</code> directory. If the application project is using an extra components directory then path to that directory has to be added in the root directory's <a class="el" href="_c_make_lists_8txt.html">CMakeLists.txt</a> file as shown in the following example.</p>
<div class="fragment"><div class="line">set(EXTRA_COMPONENT_DIRS ${CMAKE_CURRENT_SOURCE_DIR}/components)</div>
</div><!-- fragment --><p>To configure the network parameters use <code>idf.py menuconfig</code> in the aplications directory and Go to <code>Component config &gt; Dhyara ad hoc network</code> To build and flash the application use <code>idf.py build</code> and <code>idf.py flash</code> as usual.</p>
<div class="image">
<img src="menuconfig.png" alt=""/>
<div class="caption">
menuconfig</div></div>
   <p>See <a class="el" href="examples_8md.html">Building the examples</a>.</p>
<h1><a class="anchor" id="autotoc_md10"></a>
Guide</h1>
<p>ESP wifi subsystem has to be started before starting the dhyara network. <code><a class="el" href="structdhyara_1_1link.html" title="Link Layer Medium is responsible for sending packets and processing the received packets.">dhyara::link</a></code> provides the underlying communication layer over ESP NOW. The registered received callbacks should forward the received data to the <code><a class="el" href="structdhyara_1_1link.html#ad7b4f39ecaf94c52dc5739898da8a627" title="Process raw data received.">dhyara::link::_esp_rcvd_cb</a></code>. Similarly the registered sent callback should forward the arguments to the <code><a class="el" href="structdhyara_1_1link.html#a978706fc680636c3cdaaa9a3781a5754" title="ESP Send Callback.">dhyara::link::_esp_sent_cb</a></code>. A <code><a class="el" href="structdhyara_1_1network.html" title="The dhyara ad-hoc network.">dhyara::network</a></code> instance is created by using a reference to the <code>link</code>. The network is started using nonblocking <code><a class="el" href="structdhyara_1_1network.html#aadf3365c6a5506187b2f9c91ef4fdd0a" title="main network I/O">dhyara::network::start</a></code> method, which creates multiple tasks to maintain the underlying network. For rest of the application using dhyara, a reference to the <code><a class="el" href="structdhyara_1_1network.html" title="The dhyara ad-hoc network.">dhyara::network</a></code> is required. So after starting the network, the application code should pass a reference to the network instance appopriately. All nodes running dhyara will communicate with each other and transmit various packets to maintain the dynamic neighbourhood.</p>
<h2><a class="anchor" id="autotoc_md11"></a>
Design</h2>
<p>Dhyara uses many different packets for communication. The packets are defined in the <a class="el" href="group__packets.html">Packets</a> module. Type of a packet is identified using <code><a class="el" href="group__packets.html#ga587a117adc54019693a184e4f8b4e0b5" title="Packets types.">dhyara::packets::type</a></code> enum. Once a packet is received it is read and enqueued to a queue for further processing. Different actions have been defined to process different packets. The actions are defined in the <a class="el" href="group__actions.html">Actions</a> module. The actions are installed to the <code><a class="el" href="structdhyara_1_1link.html" title="Link Layer Medium is responsible for sending packets and processing the received packets.">dhyara::link</a></code> by passing the packet type and a reference to the action to <code><a class="el" href="structdhyara_1_1link.html#a279e7531ee6dccea83ce1e6c793151ab" title="Conveniance function to install an action (associate an action with a packet type).">dhyara::link::operator[]()</a></code> overload. While dequeuing a packet it finds the appropriate action through the packet type and invokes the action. The action may need to send some other packet in response. For such circumstances the action may take a reference to the <code><a class="el" href="structdhyara_1_1link.html" title="Link Layer Medium is responsible for sending packets and processing the received packets.">dhyara::link</a></code> in its constructor. Depending of the type of packet received, and the action installed, the received packet may be enqueued into another queue for further processing. Each action provides a <a class="el" href="structdhyara_1_1actions_1_1action.html#a0deb780f69c1d083514f14b524b6c1af">connect</a> method to bind a callback which will be called after the action have processed the incomming packet. The <code><a class="el" href="structdhyara_1_1network.html" title="The dhyara ad-hoc network.">dhyara::network</a></code> provides functions to get reference to all installed actions.</p>
<h2><a class="anchor" id="autotoc_md12"></a>
Usage</h2>
<p>Being a network over L2 all nodes are identified through their MAC address. <code><a class="el" href="structdhyara_1_1peer__address.html" title="peer address (mac address)">dhyara::peer_address</a></code> abstracts a MAC address representation. ESP Now uses Wifi Action Frames to communicate, which limits maximuum size of a single packet to 250 bytes. So if the application want to send variable sized messages then dhyara may split that message into multiple chunks and send those packets to the desired destination through the best route over the ad hoc network. To send a message, use <code><a class="el" href="structdhyara_1_1network.html#a6ed3eca266b9da66b2bb422d891cd145" title="Send a variable sized data to the destination.">dhyara::network::send</a></code>, which takes a destination address and <code>begin</code> and <code>end</code> iterators to the data that has to be sent.</p>
<h1><a class="anchor" id="autotoc_md13"></a>
Protocol</h1>
<p>Dhyara does not depend in IP layer. It uses MAC address to identify the nodes in the network. To establish an ad hoc network each nodes broadcasts beacon periodically which is acknowledged by its neighbourhood. The multihop network is established by sharing the routes discoverd by each of these nodes. See <a class="el" href="protocol_8md.html">Protocol</a> for details.</p>
<p>Additionally ICMP is implemented on the top of L2 to have a ping and traceroute like functionality.</p>
<h1><a class="anchor" id="autotoc_md14"></a>
Example</h1>
<p>The example below assumes that the application coed is written in a class named <code>application</code> which takes a reference to <code><a class="el" href="structdhyara_1_1network.html" title="The dhyara ad-hoc network.">dhyara::network</a></code> in its constructor and stores it in a member variable <code>_network</code>. It is also assumed that the <code>main</code> method of the <code>application</code> class is called through the main.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> application::main(){</div>
<div class="line">    <span class="comment">// defining a source and a target in the multi hop network</span></div>
<div class="line">    <a class="code" href="structdhyara_1_1peer__address.html">dhyara::peer_address</a> <a class="code" href="packets_2chunk_8h.html#ac05d2ac31c8046a03291c3c409f88e07">target</a>(<span class="stringliteral">&quot;4c:11:ae:9c:a6:85&quot;</span>), <a class="code" href="packets_2chunk_8h.html#a40e000d65a9cb5ac0507d5c7f934946c">source</a>(<span class="stringliteral">&quot;4c:11:ae:71:0f:4d&quot;</span>);</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// The anonymous function will be called once all chunks of a data packet is received</span></div>
<div class="line">    <span class="keyword">auto</span> lambda = [](<span class="keyword">const</span> <a class="code" href="structdhyara_1_1peer__address.html">dhyara::peer::address</a>&amp;, <span class="keyword">const</span> <a class="code" href="structdhyara_1_1packets_1_1data.html">dhyara::packets::data</a>&amp; data){</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;data received from &quot;</span> &lt;&lt; data.source() &lt;&lt; std::endl;</div>
<div class="line">        std::string buffer;</div>
<div class="line">        data.copy(std::back_inserter(buffer));</div>
<div class="line">        std::cout &lt;&lt; buffer &lt;&lt; std::endl;</div>
<div class="line">    };</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Bind the lambda to be called after a data is received</span></div>
<div class="line">    _network.on_data(lambda);</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">while</span>(1){</div>
<div class="line">        <span class="comment">// Assuming the same application is running on all nodes</span></div>
<div class="line">        <span class="comment">// The code below should only run in the source node</span></div>
<div class="line">        <span class="keywordflow">if</span>(_network.link().address() == <a class="code" href="packets_2chunk_8h.html#a40e000d65a9cb5ac0507d5c7f934946c">source</a>){</div>
<div class="line">            <span class="comment">// A data to be sent (strign used in the example, but can be anything that can be iterated as a sequence of bytes)</span></div>
<div class="line">            std::string buffer = <span class="stringliteral">&quot;Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry&#39;s standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged. It was popularised in the 1960s with the release of Letraset sheets containing Lorem Ipsum passages, and more recently with desktop publishing software like Aldus PageMaker including versions of Lorem Ipsum.&quot;</span>;</div>
<div class="line">            </div>
<div class="line">            <span class="comment">// send the dynamically sized data</span></div>
<div class="line">            _network.send(<a class="code" href="packets_2chunk_8h.html#ac05d2ac31c8046a03291c3c409f88e07">target</a>, buffer.begin(), buffer.end());</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// Sleep for 5s</span></div>
<div class="line">        vTaskDelay(pdMS_TO_TICKS(5000));</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p>See <a class="el" href="examples_8md.html">Building the examples</a>. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<div class="ttc" id="astructdhyara_1_1peer__address_html"><div class="ttname"><a href="structdhyara_1_1peer__address.html">dhyara::peer_address</a></div><div class="ttdoc">peer address (mac address)</div><div class="ttdef"><b>Definition:</b> <a href="peer_8h_source.html#l00029">peer.h:29</a></div></div>
<div class="ttc" id="astructdhyara_1_1packets_1_1data_html"><div class="ttname"><a href="structdhyara_1_1packets_1_1data.html">dhyara::packets::data</a></div><div class="ttdoc">A virtual packet, that is never sent accros the network.</div><div class="ttdef"><b>Definition:</b> <a href="data_8h_source.html#l00027">data.h:27</a></div></div>
<div class="ttc" id="apackets_2chunk_8h_html_a40e000d65a9cb5ac0507d5c7f934946c"><div class="ttname"><a href="packets_2chunk_8h.html#a40e000d65a9cb5ac0507d5c7f934946c">source</a></div><div class="ttdeci">dhyara::peer::address source() const</div><div class="ttdef"><b>Definition:</b> <a href="packets_2chunk_8h_source.html#l00041">chunk.h:41</a></div></div>
<div class="ttc" id="apackets_2chunk_8h_html_ac05d2ac31c8046a03291c3c409f88e07"><div class="ttname"><a href="packets_2chunk_8h.html#ac05d2ac31c8046a03291c3c409f88e07">target</a></div><div class="ttdeci">dhyara::peer::address target() const</div><div class="ttdef"><b>Definition:</b> <a href="packets_2chunk_8h_source.html#l00040">chunk.h:40</a></div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
